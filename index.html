<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Газета</title>
<style>
body { font-family: Arial; background:#f0f8f8; margin:0; padding:0; }
header { background:#028090; color:white; padding:15px; text-align:center; }
main { padding:20px; }
.card { background:#fff; border:1px solid #ccc; padding:15px; margin:10px 0; border-radius:8px; }
button { background:#00a896; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; }
button:hover { background:#028090; }
.hidden { display:none; }
textarea { width:100%; height:80px; margin-top:5px; }
input, textarea { padding:5px; border-radius:5px; border:1px solid #ccc; }
</style>
</head>
<body>
<header>
<h1>Газета</h1>
<div id="authSection">
<input id="username" placeholder="Логін">
<input id="password" type="password" placeholder="Пароль">
<button onclick="login()">Увійти</button>
<button onclick="register()">Реєстрація</button>
</div>
<div id="userSection" class="hidden">
<span id="welcomeUser"></span>
<button onclick="logout()">Вийти</button>
</div>
</header>
<main>
<div id="adminPanel" class="hidden">
<h2>Адмін панель</h2>
<input id="title" placeholder="Заголовок">
<textarea id="content" placeholder="Текст статті"></textarea><br>
<button onclick="addArticle()">Додати статтю</button>
</div>

<h2>Статті</h2>
<div id="articles"></div>
</main>

<script>
let currentUser = null;
let users = [{username:"admin", password:"1234", role:"admin"}];
let articles = [];

// --- GitHub settings ---
const GITHUB_USER = "ТВОЙ_ЛОГІН";
const GITHUB_REPO = "ТВОЙ_РЕПО";
const GITHUB_FILE = "articles.json";
const GITHUB_TOKEN = "ghp_ТВОЙ_ТОКЕН"; // ⚠️ Тримати приватним

// --- Load articles ---
async function loadArticles(){
  try{
    let res = await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/${GITHUB_FILE}`);
    articles = await res.json();
    renderArticles();
  }catch(e){console.error("Не вдалося завантажити статті", e);}
}

function renderArticles(){
  const div = document.getElementById("articles");
  div.innerHTML = "";
  articles.forEach((a,i)=>{
    let html = `<div class='card'>
      <h3>${a.title}</h3>
      <p>${a.content}</p>`;
    if(currentUser?.role==="admin"){
      html += `<button onclick="deleteArticle(${i})">Видалити</button>`;
    }
    html += "</div>";
    div.innerHTML += html;
  });
}

// --- Admin functions ---
function addArticle(){
  let title = document.getElementById("title").value;
  let content = document.getElementById("content").value;
  if(title && content){
    articles.push({title, content});
    renderArticles();
    pushToGitHub();
  }else alert("Заповніть всі поля");
}

function deleteArticle(i){
  articles.splice(i,1);
  renderArticles();
  pushToGitHub();
}

// --- Auth ---
function login(){
  let u = document.getElementById("username").value;
  let p = document.getElementById("password").value;
  let user = users.find(x=>x.username===u && x.password===p);
  if(user){
    currentUser = user;
    document.getElementById("authSection").classList.add("hidden");
    document.getElementById("userSection").classList.remove("hidden");
    document.getElementById("welcomeUser").innerText = "Привіт, "+u;
    if(user.role==="admin") document.getElementById("adminPanel").classList.remove("hidden");
  } else { alert("Невірні дані"); }
}

function register(){
  let u = document.getElementById("username").value;
  let p = document.getElementById("password").value;
  if(!users.find(x=>x.username===u)){
    users.push({username:u, password:p, role:"comment"});
    alert("Реєстрація успішна!");
  } else { alert("Користувач існує!"); }
}

function logout(){
  currentUser=null;
  document.getElementById("authSection").classList.remove("hidden");
  document.getElementById("userSection").classList.add("hidden");
  document.getElementById("adminPanel").classList.add("hidden");
}

// --- GitHub Push ---
async function pushToGitHub(){
  try{
    // Get SHA of file
    let res = await fetch(`https://api.github.com/repos/${bogicer}/${online-newspaper}/contents/${articles.json}`,{
      headers:{Authorization:"token "+GITHUB_TOKEN}
    });
    let data = await res.json();
    let sha = data.sha;

    // Update file
    let commitMessage = "Оновлення статей через сайт";
    let content = btoa(unescape(encodeURIComponent(JSON.stringify(articles, null, 2))));

    await fetch(`https://api.github.com/repos/${bogicer}/${online-newspaper}/contents/${articles.json}`,{
      method:"PUT",
      headers:{
        "Authorization":"token "+GITHUB_TOKEN,
        "Accept":"application/vnd.github.v3+json"
      },
      body: JSON.stringify({message:commitMessage, content:content, sha:sha})
    });
    alert("Статті оновлено на GitHub!");
  }catch(e){console.error("Помилка пушу на GitHub", e);}
}

loadArticles();
</script>
</body>
</html>
